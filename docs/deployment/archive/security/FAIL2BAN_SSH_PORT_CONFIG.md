# ðŸ”’ Fail2ban SSHãƒãƒ¼ãƒˆè¨­å®šï¼ˆ23456å¯¾å¿œï¼‰

**ä½œæˆæ—¥**: 2025-11-02  
**å¯¾è±¡**: Dockerã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦å‹•ä½œã—ã¦ã„ã‚‹Fail2banï¼ˆã‚«ã‚¹ã‚¿ãƒ SSHãƒãƒ¼ãƒˆ23456å¯¾å¿œï¼‰

---

## ðŸ“‹ ç¾åœ¨ã®çŠ¶æ³

- âœ… Fail2banã‚³ãƒ³ãƒ†ãƒŠ: ç¨¼åƒä¸­
- âœ… SSH jail: æœ‰åŠ¹ï¼ˆ31å€‹ã®IPãŒBANä¸­ï¼‰
- âš ï¸ SSHãƒãƒ¼ãƒˆè¨­å®š: `port = ssh`ï¼ˆæ¨™æº–ãƒãƒ¼ãƒˆ22ã‚’ç›£è¦–ã—ã¦ã„ã‚‹å¯èƒ½æ€§ï¼‰

---

## ðŸ” è¨­å®šã®ç¢ºèª

### ã‚¹ãƒ†ãƒƒãƒ—1: ç¾åœ¨ã®è¨­å®šã‚’ç¢ºèª

```bash
# jail.dãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
docker exec fail2ban ls -la /data/jail.d/

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ç¢ºèªï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
docker exec fail2ban cat /data/jail.d/*.local 2>/dev/null || echo "è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"

# ã¾ãŸã¯ã€ãƒ¡ã‚¤ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
docker exec fail2ban cat /etc/fail2ban/jail.local 2>/dev/null || docker exec fail2ban cat /etc/fail2ban/jail.conf | grep -A 10 "\[sshd\]"
```

---

### ã‚¹ãƒ†ãƒƒãƒ—2: SSHãƒãƒ¼ãƒˆè¨­å®šã®ç¢ºèª

```bash
# å®Ÿéš›ã«ç›£è¦–ã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ãƒˆã‚’ç¢ºèª
docker exec fail2ban fail2ban-client status sshd | grep -i port

# ã¾ãŸã¯ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç›´æŽ¥ç¢ºèª
docker exec fail2ban grep -i "port" /etc/fail2ban/jail.d/*.local 2>/dev/null || docker exec fail2ban grep -A 5 "\[sshd\]" /etc/fail2ban/jail.conf | grep -i port
```

---

## ðŸ› ï¸ è¨­å®šã®ä¿®æ­£ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

ç¾åœ¨ã€31å€‹ã®IPãŒBANã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€Fail2banã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚  
ãŸã ã—ã€SSHãƒãƒ¼ãƒˆï¼ˆ23456ï¼‰ã‚’æ­£ç¢ºã«ç›£è¦–ã™ã‚‹ãŸã‚ã€è¨­å®šã‚’ç¢ºèªãƒ»ä¿®æ­£ã™ã‚‹ã“ã¨ã‚’æŽ¨å¥¨ã—ã¾ã™ã€‚

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: jail.dãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

```bash
# ã‚³ãƒ³ãƒ†ãƒŠã«æŽ¥ç¶šã—ã¦è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
docker exec -it fail2ban sh

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > /data/jail.d/sshd.local << 'EOF'
[sshd]
enabled = true
port = 23456
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 86400
findtime = 3600
EOF

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚’è¨­å®š
chmod 644 /data/jail.d/sshd.local

# ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å‡ºã‚‹
exit

# Fail2banã‚’å†èª­ã¿è¾¼ã¿
docker exec fail2ban fail2ban-client reload

# è¨­å®šã‚’ç¢ºèª
docker exec fail2ban fail2ban-client status sshd
```

---

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒžã‚¦ãƒ³ãƒˆçµŒç”±ã§è¨­å®š

Fail2banã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šãŒãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒžã‚¦ãƒ³ãƒˆçµŒç”±ã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼š

```bash
# ãƒ›ã‚¹ãƒˆå´ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’ç¢ºèª
docker inspect fail2ban | grep -A 10 "Mounts"

# ãƒ›ã‚¹ãƒˆå´ã§è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã¾ãŸã¯ç·¨é›†
# ä¾‹: /path/to/fail2ban/data/jail.d/sshd.local
```

---

## âœ… è¨­å®šç¢ºèªå¾Œã®å‹•ä½œç¢ºèª

### ã‚¹ãƒ†ãƒƒãƒ—1: Fail2banã®å†èª­ã¿è¾¼ã¿

```bash
# Fail2banã®è¨­å®šã‚’å†èª­ã¿è¾¼ã¿
docker exec fail2ban fail2ban-client reload

# çŠ¶æ…‹ã‚’ç¢ºèª
docker exec fail2ban fail2ban-client status sshd
```

### ã‚¹ãƒ†ãƒƒãƒ—2: SSHãƒãƒ¼ãƒˆè¨­å®šã®ç¢ºèª

```bash
# SSH jailã®è¨­å®šã‚’ç¢ºèª
docker exec fail2ban fail2ban-client status sshd

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# Status for the jail: sshd
# |- Filter
# |  |- Currently failed: 0
# |  |- Total failed:     XXX
# |  `- File list:        /var/log/auth.log
# `- Actions
#    |- Currently banned: XX
#    |- Total banned:     XXX
#    `- Banned IP list:   ...
```

---

## ðŸ“Š ç¾åœ¨ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ³ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹æ©Ÿèƒ½

- âœ… **Fail2banã‚³ãƒ³ãƒ†ãƒŠ**: ç¨¼åƒä¸­ï¼ˆUp 8 days (healthy)ï¼‰
- âœ… **SSH jail**: æœ‰åŠ¹ãƒ»å‹•ä½œä¸­
- âœ… **ç¾åœ¨31å€‹ã®IPãŒBANä¸­**: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œã‚’æ¤œå‡ºã—ã¦ãƒ–ãƒ­ãƒƒã‚¯
- âœ… **ç·BANæ•°: 189å›ž**: ã“ã‚Œã¾ã§ã«å¤šæ•°ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯
- âœ… **ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œ: 257å›žæ¤œå‡º**: æ”»æ’ƒã‚’æ­£å¸¸ã«æ¤œå‡º

---

## ðŸ’¡ é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

### ç¾åœ¨ã®çŠ¶æ…‹

Fail2banã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ãŠã‚Šã€å¤šæ•°ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œã‚’æ¤œå‡ºã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚  
ã“ã‚Œã¯ã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®çŠ¶æ…‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼š

1. **æ¨™æº–SSHãƒãƒ¼ãƒˆï¼ˆ22ï¼‰ã‚’ç›£è¦–ã—ã¦ã„ã‚‹å ´åˆ**
   - ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã‚„ã‚µãƒ¼ãƒ“ã‚¹ãŒãƒãƒ¼ãƒˆ22ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§
   - ã¾ãŸã¯ã€SSHãƒãƒ¼ãƒˆ22ã¸ã®æ”»æ’ƒã‚’æ¤œå‡ºã—ã¦ã„ã‚‹

2. **ã‚«ã‚¹ã‚¿ãƒ SSHãƒãƒ¼ãƒˆï¼ˆ23456ï¼‰ã‚’æ—¢ã«ç›£è¦–ã—ã¦ã„ã‚‹å ´åˆ**
   - ç¾åœ¨ã®è¨­å®šã§æ—¢ã«æ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹

3. **ä¸¡æ–¹ã®ãƒãƒ¼ãƒˆã‚’ç›£è¦–ã—ã¦ã„ã‚‹å ´åˆ**
   - ã‚ˆã‚Šåºƒç¯„å›²ãªä¿è­·ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹

---

## ðŸ” ç¢ºèªã™ã¹ãé …ç›®

- [ ] å®Ÿéš›ã«ç›£è¦–ã•ã‚Œã¦ã„ã‚‹SSHãƒãƒ¼ãƒˆç•ªå·
- [ ] SSHãƒãƒ¼ãƒˆï¼ˆ23456ï¼‰ã¸ã®æ”»æ’ƒãŒæ¤œå‡ºã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã¨å†…å®¹
- [ ] è¨­å®šå¤‰æ›´ãŒå¿…è¦ã‹

---

## ðŸ“š å‚è€ƒè³‡æ–™

- [Fail2banå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.fail2ban.org/)
- [Fail2banã‚³ãƒ³ãƒ†ãƒŠç¢ºèªã‚¬ã‚¤ãƒ‰](FAIL2BAN_CONTAINER_CHECK.md)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚¬ã‚¤ãƒ‰](EXTERNAL_ACCESS_SECURITY.md)

---

**ä½œæˆæ—¥**: 2025-11-02  
**æ›´æ–°æ—¥**: 2025-11-02  
**ä½œæˆè€…**: AI Assistant

