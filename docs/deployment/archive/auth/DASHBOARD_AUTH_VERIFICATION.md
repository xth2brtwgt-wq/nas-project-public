# ✅ ダッシュボード認証統合 動作確認手順

**作成日**: 2025-11-04  
**目的**: ダッシュボード認証統合機能の動作確認

---

## ✅ 初期ユーザー作成完了

初期ユーザー「admin」が正常に作成されました。

---

## 🔍 動作確認手順

### 1. ログの確認

```bash
cd ~/nas-project/nas-dashboard
sudo docker compose logs nas-dashboard | grep -i "認証"
```

以下のようなログが表示されれば正常です：

```
認証データベースを初期化しました
初期ユーザー「admin」を作成しました
```

### 2. ブラウザでアクセス

以下のURLにアクセスしてください：

- **内部アクセス**: `http://192.168.68.110:9001/`
- **外部アクセス**: `https://yoshi-nas-sys.duckdns.org:8443/`（Nginx Proxy Manager経由の場合）

### 3. ログインページの確認

1. ブラウザでアクセスすると、ログインページが表示されることを確認
2. ログインページのデザインが正しく表示されることを確認

### 4. ログイン機能の確認

1. 初期ユーザー（`admin`）でログイン
2. ダッシュボードにリダイレクトされることを確認
3. ナビゲーションバーに「ユーザー管理」と「ログアウト (admin)」リンクが表示されることを確認

### 5. ダッシュボード機能の確認

1. ダッシュボードの各機能が正常に動作することを確認
2. サービス一覧が表示されることを確認
3. システム監視データが表示されることを確認

### 6. ユーザー管理画面の確認

1. ナビゲーションバーの「ユーザー管理」をクリック
2. ユーザー一覧が表示されることを確認
3. 初期ユーザー「admin」が一覧に表示されることを確認
4. ユーザーの状態が「有効」になっていることを確認

### 7. ユーザー追加機能の確認

1. 「ユーザー追加」ボタンをクリック
2. 新しいユーザーを追加（例：ユーザー名「testuser」、パスワード「test123」）
3. ユーザー一覧に戻り、追加したユーザーが表示されることを確認
4. 追加したユーザーでログアウトして、新しいユーザーでログインできることを確認

### 8. ユーザー編集機能の確認

1. ユーザー一覧で「編集」ボタンをクリック
2. ユーザー名を変更して保存
3. 変更が反映されることを確認

### 9. ログアウト機能の確認

1. ナビゲーションバーの「ログアウト (admin)」をクリック
2. ログインページにリダイレクトされることを確認
3. 再度ログインできることを確認

### 10. セッション管理の確認

1. ログイン後、30分間何もしない状態を維持
2. 30分後にページをリロード
3. ログインページにリダイレクトされることを確認（セッションタイムアウト）

---

## 📝 確認項目チェックリスト

- [ ] ログインページが表示される
- [ ] 初期ユーザーでログインできる
- [ ] ダッシュボードにリダイレクトされる
- [ ] ナビゲーションバーに「ユーザー管理」と「ログアウト」リンクが表示される
- [ ] ユーザー一覧が表示される
- [ ] ユーザー追加機能が動作する
- [ ] ユーザー編集機能が動作する
- [ ] ログアウト機能が動作する
- [ ] セッション管理が正常に動作する

---

## 🔍 トラブルシューティング

### エラー: ログインページが表示されない

**原因**: 認証チェックが正しく動作していない

**解決方法**:

1. アプリケーションのログを確認：

```bash
sudo docker compose logs nas-dashboard
```

2. 認証データベースが初期化されているか確認：

```bash
sudo docker compose exec nas-dashboard python -c "
import sys
sys.path.insert(0, '/nas-project/nas-dashboard')
from utils.auth_db import get_all_users
print(get_all_users())
"
```

### エラー: ログインできない

**原因**: パスワードが間違っている、またはユーザーが存在しない

**解決方法**:

1. ユーザー一覧を確認：

```bash
sudo docker compose exec nas-dashboard python -c "
import sys
sys.path.insert(0, '/nas-project/nas-dashboard')
from utils.auth_db import get_all_users
import json
print(json.dumps(get_all_users(), indent=2, default=str))
"
```

2. パスワードを確認して、正しいパスワードでログインしてください。

### エラー: ユーザー管理画面が表示されない

**原因**: 認証チェックが正しく動作していない

**解決方法**:

1. アプリケーションのログを確認：

```bash
sudo docker compose logs nas-dashboard | grep -i "認証\|エラー"
```

2. コンテナを再起動：

```bash
sudo docker compose restart nas-dashboard
```

---

## 📝 注意事項

1. **セッションタイムアウト**: デフォルトで30分に設定されています
2. **パスワード管理**: パスワードはbcryptでハッシュ化されて保存されます
3. **データベースの場所**: `/home/AdminUser/nas-project-data/nas-dashboard/auth.db`
4. **初期ユーザー**: 最初のユーザーは必ず作成してください

---

**作成日**: 2025-11-04  
**更新日**: 2025-11-04  
**作成者**: AI Assistant

