<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ app_name }} - ダッシュボード</title>
    <link rel="icon" href="{{ subfolder_path }}/static/favicon.svg" type="image/svg+xml">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ subfolder_path }}/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <a href="https://yoshi-nas-sys.duckdns.org:8443/" class="navbar-brand mb-0 h1 text-white text-decoration-none" title="ダッシュボードに戻る" style="display: flex; align-items: center;">
                <i class="fas fa-arrow-left me-2" style="font-size: 1.2em;"></i><span>📊 {{ app_name }}</span>
            </a>
            <span class="navbar-text text-white">
                <small>v{{ version }}</small>
            </span>
        </div>
    </nav>

    <div class="container mt-4">

        <nav class="tabs">
            <button class="tab-btn active" data-tab="overview">概要</button>
            <button class="tab-btn" data-tab="upload">アップロード</button>
            <button class="tab-btn" data-tab="purchases">購入履歴</button>
            <button class="tab-btn" data-tab="analysis">分析</button>
        </nav>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <h2>📈 概要ダッシュボード</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>総支出額</h3>
                    <p class="stat-value" id="total-spent">¥0</p>
                </div>
                <div class="stat-card">
                    <h3>購入件数</h3>
                    <p class="stat-value" id="total-purchases">0</p>
                </div>
                <div class="stat-card">
                    <h3>注文回数</h3>
                    <p class="stat-value" id="unique-orders">0</p>
                </div>
                <div class="stat-card">
                    <h3>データ期間</h3>
                    <p class="stat-value-sm" id="date-range">-</p>
                </div>
            </div>

            <div class="chart-container">
                <h3>カテゴリ別支出</h3>
                <canvas id="category-chart"></canvas>
            </div>
        </div>

        <!-- Upload Tab -->
        <div id="upload" class="tab-content">
            <h2>📤 CSVアップロード</h2>
            
            <div class="upload-section">
                <div class="upload-area" id="drop-zone">
                    <p>📁 CSVファイルをドラッグ&ドロップ</p>
                    <p>または</p>
                    <label for="file-input" class="btn-upload">ファイルを選択</label>
                    <input type="file" id="file-input" accept=".csv" style="display: none;">
                </div>
                
                <div id="upload-status" style="display: none;">
                    <p class="status-text"></p>
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                </div>
            </div>

            <div class="import-history">
                <h3>インポート履歴</h3>
                <div id="import-history-list"></div>
            </div>
        </div>

        <!-- Purchases Tab -->
        <div id="purchases" class="tab-content">
            <h2>🛍️ 購入履歴</h2>
            
            <div class="filters">
                <select id="category-filter">
                    <option value="">全カテゴリ</option>
                </select>
                <button class="btn" onclick="loadPurchases()">検索</button>
            </div>

            <div id="purchases-list"></div>
        </div>

        <!-- Analysis Tab -->
        <div id="analysis" class="tab-content">
            <h2>🔍 AI分析</h2>
            
            <div class="analysis-section">
                <h3>自動カテゴリ分類</h3>
                <p>購入商品を自動でカテゴリに分類します（OpenAI APIが必要）</p>
                <button class="btn" onclick="autoClassify()">分類を実行</button>
            </div>

            <div class="analysis-section">
                <h3>衝動買い検出</h3>
                <button class="btn" onclick="analyzeImpulse()">分析を実行</button>
                <div id="impulse-results"></div>
            </div>

            <div class="analysis-section">
                <h3>定期購入パターン</h3>
                <button class="btn" onclick="analyzeRecurring()">分析を実行</button>
                <div id="recurring-results"></div>
            </div>

            <div class="analysis-section">
                <h3>月次インサイト</h3>
                <div class="month-selector">
                    <input type="number" id="insight-year" value="2025" min="2000" max="2100">
                    <select id="insight-month">
                        <option value="1">1月</option>
                        <option value="2">2月</option>
                        <option value="3">3月</option>
                        <option value="4">4月</option>
                        <option value="5">5月</option>
                        <option value="6">6月</option>
                        <option value="7">7月</option>
                        <option value="8">8月</option>
                        <option value="9">9月</option>
                        <option value="10" selected>10月</option>
                        <option value="11">11月</option>
                        <option value="12">12月</option>
                    </select>
                    <button class="btn" onclick="generateInsights()">生成</button>
                </div>
                <div id="insights-results"></div>
            </div>
        </div>
    </div>

    <script>
        // サブフォルダパスをJavaScriptに渡す
        window.SUBFOLDER_PATH = '{{ subfolder_path }}';
    </script>
    <script src="{{ subfolder_path }}/static/js/app.js"></script>
</body>
</html>

