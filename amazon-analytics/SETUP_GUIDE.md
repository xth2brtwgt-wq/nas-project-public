# Amazon Purchase Analytics - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## ðŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆDockerä½¿ç”¨ï¼‰

### 1. ç’°å¢ƒè¨­å®š

```bash
cd /Users/Yoshi/nas-project/amazon-analytics

# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cp env.example .env

# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
nano .env
```

ä»¥ä¸‹ã®é …ç›®ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

```env
# å¿…é ˆé …ç›®
POSTGRES_PASSWORD=your_secure_password_here
OPENAI_API_KEY=sk-your-openai-api-key-here

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³
NOTION_API_KEY=ï¼ˆNotioné€£æºã‚’ä½¿ã†å ´åˆï¼‰
```

### 2. Docker Composeã§èµ·å‹•

```bash
# ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ãƒ»èµ·å‹•
docker-compose up -d

# ãƒ­ã‚°ã‚’ç¢ºèª
docker-compose logs -f web
```

### 3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹

```
http://localhost:8000
```

### 4. åˆæœŸè¨­å®š

1. ã€Œã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã‚¿ãƒ–ã‚’é–‹ã
2. Amazonã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
3. ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚Šè¾¼ã¾ã‚Œã‚‹ã®ã‚’å¾…ã¤
4. ã€Œæ¦‚è¦ã€ã‚¿ãƒ–ã§çµ±è¨ˆã‚’ç¢ºèª

## ðŸ“Š Amazonã‹ã‚‰CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•

1. **Amazonã«ãƒ­ã‚°ã‚¤ãƒ³**
   - https://www.amazon.co.jp

2. **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š**
   - å³ä¸Šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ â†’ ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã€

3. **æ³¨æ–‡å±¥æ­´ã‚’è¡¨ç¤º**
   - ã€Œæ³¨æ–‡å±¥æ­´ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

4. **ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
   - ã€Œæ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡

5. **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**
   - ãƒ¡ãƒ¼ãƒ«ã§é€šçŸ¥ãŒæ¥ãŸã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‹ã‚‰ZIPã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   - ZIPã‚’è§£å‡ã™ã‚‹ã¨è¤‡æ•°ã®ãƒ•ã‚©ãƒ«ãƒ€ãŒå«ã¾ã‚Œã¦ã„ã¾ã™

6. **å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«**
   - `Retail.OrderHistory.3/Retail.OrderHistory.3.csv` ãŒä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«

## ðŸ”§ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Dockerã‚’ä½¿ã‚ãšã«ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ç™ºã™ã‚‹å ´åˆï¼š

### 1. Pythonç’°å¢ƒã‚’æº–å‚™

```bash
# Python 3.11ä»¥ä¸ŠãŒå¿…è¦
python --version

# ä»®æƒ³ç’°å¢ƒä½œæˆ
python -m venv venv
source venv/bin/activate  # macOS/Linux
# venv\Scripts\activate  # Windows

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt
```

### 2. PostgreSQLã¨Redisã‚’èµ·å‹•

```bash
# Dockerã§èµ·å‹•
docker-compose up -d db redis

# ã¾ãŸã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‚ã®ã‚’ä½¿ç”¨
```

### 3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

```bash
cp env.example .env
# .envã‚’ç·¨é›†ã—ã¦DATABASE_URLãªã©ã‚’è¨­å®š
```

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–

```bash
# Pythonã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚·ã‚§ãƒ«ã§
python
>>> from app.models.database import init_db
>>> init_db()
>>> exit()
```

### 5. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•

```bash
uvicorn app.api.main:app --reload --host 0.0.0.0 --port 8000
```

## ðŸ§ª å‹•ä½œç¢ºèª

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```bash
curl http://localhost:8000/api/health
```

æœŸå¾…ã•ã‚Œã‚‹çµæžœï¼š
```json
{
  "status": "healthy",
  "version": "1.0.0",
  "app": "Amazon Purchase Analytics"
}
```

### CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆ

```bash
curl -X POST http://localhost:8000/api/upload \
  -F "file=@/path/to/Retail.OrderHistory.3.csv"
```

### ã‚«ãƒ†ã‚´ãƒªåˆæœŸåŒ–

```bash
curl -X POST http://localhost:8000/api/categories/initialize
```

## ðŸ“ ä½¿ã„æ–¹

### 1. ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã€Œã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã‚¿ãƒ–
- CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
- è‡ªå‹•çš„ã«å‡¦ç†ãŒé–‹å§‹ã•ã‚Œã¾ã™

### 2. çµ±è¨ˆã‚’ç¢ºèª

- ã€Œæ¦‚è¦ã€ã‚¿ãƒ–ã§å…¨ä½“ã®çµ±è¨ˆã‚’ç¢ºèª
- ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡ºã®ã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤º

### 3. è³¼å…¥å±¥æ­´ã‚’é–²è¦§

- ã€Œè³¼å…¥å±¥æ­´ã€ã‚¿ãƒ–ã§è©³ç´°ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
- ã‚«ãƒ†ã‚´ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¯èƒ½

### 4. AIåˆ†æžã‚’å®Ÿè¡Œ

**è‡ªå‹•ã‚«ãƒ†ã‚´ãƒªåˆ†é¡ž**
- ã€Œåˆ†æžã€ã‚¿ãƒ– â†’ ã€Œè‡ªå‹•ã‚«ãƒ†ã‚´ãƒªåˆ†é¡žã€
- OpenAI APIã‚’ä½¿ç”¨ã—ã¦å•†å“ã‚’è‡ªå‹•åˆ†é¡ž

**è¡å‹•è²·ã„æ¤œå‡º**
- çŸ­æœŸé–“ã§ã®è¤‡æ•°è³¼å…¥ã‚’æ¤œå‡º
- ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®è³¼å…¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æž

**å®šæœŸè³¼å…¥å€™è£œ**
- ç¹°ã‚Šè¿”ã—è³¼å…¥ã—ã¦ã„ã‚‹å•†å“ã‚’æ¤œå‡º
- å®šæœŸä¾¿ã¸ã®åˆ‡ã‚Šæ›¿ãˆå€™è£œã‚’ææ¡ˆ

**æœˆæ¬¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆ**
- å¹´æœˆã‚’æŒ‡å®šã—ã¦AIåˆ†æžã‚’å®Ÿè¡Œ
- ç¯€ç´„ã®ãŸã‚ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ç”Ÿæˆ

## ðŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šã‚¨ãƒ©ãƒ¼

```bash
# ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ã‚’ç¢ºèª
docker-compose ps

# DBã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã‚’ç¢ºèª
docker-compose logs db

# DBã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•
docker-compose restart db
```

### CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼

**ã€ŒUnknown CSV formatã€ã‚¨ãƒ©ãƒ¼**
- æ­£ã—ã„CSVãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆRetail.OrderHistory.3.csvï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æã—ã¦ã„ãªã„ã‹ç¢ºèª

**ã€ŒNo valid orders foundã€ã‚¨ãƒ©ãƒ¼**
- CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒæ­£ã—ã„ã‹ç¢ºèª

### OpenAI API ã‚¨ãƒ©ãƒ¼

**ã€ŒOpenAI API key not configuredã€**
- `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«`OPENAI_API_KEY`ã‚’è¨­å®š
- ã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•: `docker-compose restart web`

**ã€ŒRate limit exceededã€**
- OpenAI APIã®åˆ©ç”¨åˆ¶é™ã«é”ã—ã¦ã„ã¾ã™
- ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œ
- ã¾ãŸã¯ã€ã‚ˆã‚Šå°‘ãªã„ä»¶æ•°ã§åˆ†é¡žã‚’å®Ÿè¡Œ

## ðŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### æœ¬ç•ªç’°å¢ƒã§ã®æ³¨æ„ç‚¹

1. **å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š**
   ```env
   POSTGRES_PASSWORD=very_secure_random_password_here
   ```

2. **APIã‚­ãƒ¼ã‚’é©åˆ‡ã«ç®¡ç†**
   - `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„
   - ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦å®‰å…¨ã«ç®¡ç†

3. **ãƒãƒ¼ãƒˆã®åˆ¶é™**
   - å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒãªã„å ´åˆã¯å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã¿ã«åˆ¶é™

4. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**
   ```bash
   # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
   docker-compose exec db pg_dump -U postgres amazon_analytics > backup.sql
   
   # ãƒªã‚¹ãƒˆã‚¢
   docker-compose exec -T db psql -U postgres amazon_analytics < backup.sql
   ```

## ðŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–

### å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†

1ä¸‡ä»¶ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆï¼š

1. **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æœ€é©åŒ–**
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã™

2. **ãƒãƒƒãƒå‡¦ç†**
   - è‡ªå‹•åˆ†é¡žã¯å°‘ã—ãšã¤å®Ÿè¡Œï¼ˆlimit ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰

3. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨**
   - RedisãŒçµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¾ã™

## ðŸ†˜ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆï¼š

1. ãƒ­ã‚°ã‚’ç¢ºèª
   ```bash
   docker-compose logs web
   ```

2. ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ã‚’ç¢ºèª
   ```bash
   docker-compose ps
   docker-compose top
   ```

3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç›´æŽ¥æŽ¥ç¶š
   ```bash
   docker-compose exec db psql -U postgres amazon_analytics
   ```

## ðŸ”„ æ›´æ–°ãƒ»ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

```bash
# ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°
git pull

# ã‚³ãƒ³ãƒ†ãƒŠã‚’å†ãƒ“ãƒ«ãƒ‰
docker-compose down
docker-compose build
docker-compose up -d
```

## ðŸ—‘ï¸ ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ã‚³ãƒ³ãƒ†ãƒŠã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å‰Šé™¤
docker-compose down -v

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤
cd ..
rm -rf amazon-analytics
```

